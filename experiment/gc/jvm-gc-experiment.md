# π§ JVM GC μ‹¤ν— μ •λ¦¬

## 1. μ‹¤ν— ν™κ²½

- **JDK λ²„μ „**: 17
- **μ‹¤ν–‰ μµμ…**: `-Xmx128m -Xms128m -XX:+UseG1GC -XX:+PrintGCDetails`
- **μ»΄νμΌ λ…λ Ή**: `javac -d src src/com/psjw/gc/GCPractice.java`
- **μ‹¤ν–‰ λ…λ Ή**: Β 
```bash
Β  java -Xmx128m -Xms128m -XX:+UseG1GC -XX:+PrintGCDetails -Xlog:gc*:file=gc.log -cp src com.psjw.gc.GCPractice
```
Β 


## 2. μ‹¤ν— μ½”λ“

```java
List<byte[]> list = new ArrayList<>();  
for (int i = 0; i < 1000; i++) {  
    list.add(new byte[1024 * 1024]); // 1MB κ°μ²΄ ν• λ‹Ή  
    if (i % 10 == 0) Thread.sleep(100);  
}
```
> G1GCμ—μ„ Humongous κ°μ²΄κ°€ 1MB heapμ—μ„ μ–Όλ§λ‚ λΉ¨λ¦¬ λ„μ λκ³  μ–΄λ–»κ² GCκ°€ λ°μ‘ν•λ”μ§€ κ΄€μ°°


## 3. μ‹¤ν— λ©ν‘
- Eden β†’ Survivor β†’ Oldλ΅μ κ°μ²΄ μ΄λ™ κ΄€μ°°
- Humongous κ°μ²΄κ°€ μ–΄λ–»κ² ν• λ‹Ήλκ³  GCκ°€ μ–΄λ–»κ² λ°μ‘ν•λ”μ§€ ν™•μΈ
- Full GC λ° Compaction λ™μ‘ μ λ„ λ° ν™•μΈ

## 4. λ΅κ·Έ κΈ°λ° μ£Όμ” λ¶„μ„ ν¬μΈνΈ
### 4-1. GC λ΅κ·Έ μƒμ„Έ λΌμΈλ³„ ν•΄μ„
```text
[0.009s][info   ][gc,heap     ] Heap Region Size: 1M
```
- **μ‹μ **: ν”„λ΅κ·Έλ¨ μ‹μ‘ 0.009μ΄ ν›„
- **μλ―Έ**: G1GCλ” heapμ„ λ™μΌ ν¬κΈ°μ regionμΌλ΅ λ‚λ„λ©°, κ° regionμ ν¬κΈ°λ” 1MBλ΅ μ„¤μ •λ¨
	- G1GCλ” λ©”λ¨λ¦¬λ¥Ό 2048λ΅ λ‚λ κ²ƒμ΄ region sizeκ°€ λ¨
	- 128M/2048 = 64KBλ΅ μµμ† regionμΈ 1MBλ΅ μƒμΉ
- **μ‹¤λ¬΄ ν¬μΈνΈ**: μ‘μ€ heap(128MB)μ—μ„  1MB regionμ΄ κΈ°λ³Έ, λ” ν° heapμ—μ„  μλ™μΌλ΅ μ»¤μ§ μ μμ

```text
[0.351s][info   ][gc,start    ] GC(0) Pause Young (Concurrent Start) (G1 Humongous Allocation)
```
- **GC λ²νΈ**: GC(0) β†’ μ²« λ²μ§Έ GC μ‚¬μ΄ν΄
- **GC νƒ€μ…**: Young GC, Humongous κ°μ²΄λ΅ μΈν• λ°μƒ
- **μλ―Έ**: ν° κ°μ²΄(> regionμ 50%)κ°€ Edenμ— ν• λ‹Ήλμ–΄ Humongous regionμ— μ €μ¥λ¨ β†’ GC μ λ„
- **μ‹¤λ¬΄ ν¬μΈνΈ**: ν° λ°°μ—΄, μ΄λ―Έμ§€ λ°μ΄ν„° λ“±μ„ μμ£Ό λ‹¤λ£° λ• Humongous allocation λ°μƒλ¥  μ£Όμ

```text
[0.352s][info   ][gc,heap     ] GC(0) Eden regions: 1->0(28)
```
- **ν•΄μ„**: GC μ „ Edenμ— region 1κ° β†’ GC ν›„ 0κ°, μµλ€ 28κ°κΉμ§€ μ‚¬μ© κ°€λ¥
- **μ‹¤λ¬΄ ν¬μΈνΈ**: (28)μ€ ν•΄λ‹Ή μ‹μ μ Eden μμ—­ μ©λ‰ ν•κ³„ = 28MB
- **μ¶”κ°€ μ •λ³΄**: κ°μ²΄κ°€ Survivorλ‚ Oldλ΅ μ΄λ™ν–μμ„ μλ―Έ

```text
[0.352s][info Β  ][gc,heap Β  Β  ] GC(0) Survivor regions: 0->1(3)
```
- **ν•΄μ„**: GC μ „ Suvivorμ— region 1κ° β†’ GC ν›„ 1κ°, μµλ€ 3κ°κΉμ§€ μ‚¬μ© κ°€λ¥
- **μ‹¤λ¬΄ ν¬μΈνΈ**: (3)μ€ ν•΄λ‹Ή μ‹μ μ Survivor μμ—­ μ©λ‰ ν•κ³„ = 3MB
- **μ¶”κ°€ μ •λ³΄**: GCλ¥Ό ν†µν•΄ Edenμμ—­μ—μ„ Survivorμμ—­μΌλ΅ μ΄λ™ν–μμ„ μλ―Έ

```text
[0.352s][info   ][gc,heap     ] GC(0) Old regions: 2->2
```
- **ν•΄μ„**: Old μμ—­μ΄ GC ν›„μ—λ„ μ¤„μ§€ μ•μ = λ€λ¶€λ¶„ μ•„μ§ reachable
- **μ‹¤λ¬΄ ν¬μΈνΈ**: Old κ°μ²΄κ°€ μ‚΄μ•„μμΌλ©΄ Full GCλ‚ Compaction λ€μƒ κ°€λ¥μ„± λ†’μ

```text
[0.352s][info   ][gc,heap     ] GC(0) Humongous regions: 56->56
```
- **ν•΄μ„**: Humongous μμ—­μ΄ GC ν›„μ—λ„ μ¤„μ§€ μ•μ = λ€λ¶€λ¶„ μ•„μ§ reachable
- **μ‹¤λ¬΄ ν¬μΈνΈ**: Humongous κ°μ²΄κ°€ μ‚΄μ•„μμΌλ©΄ Full GCλ‚ Compaction λ€μƒ κ°€λ¥μ„± λ†’μ

```text
[0.779s][info   ][gc          ] GC(2) Pause Young (Prepare Mixed) (G1 Humongous Allocation) (Evacuation Failure: Allocation) 125M->125M(128M)
```
- **μ΄λ²¤νΈ**: GC(2)λ” Evacuation μ‹¤ν¨ β†’ κ³µκ°„ λ¶€μ΅±(Edenμ—μ„ Survivor λλ” Oldλ΅ κ°μ²΄ μ΄λ™μ΄ μ‹¤ν¨ν•¨)
- **ν„μƒ**: GC ν›„μ—λ„ heap ν¬κΈ° λ³€ν™” μ—†μ
- **μ‹¤λ¬΄ ν¬μΈνΈ**: G1GCμ Edenβ†’Survivorβ†’Old μ΄λ™μ΄ μ‹¤ν¨ν•μ—¬ GCκ°€ **Full GC**λ΅ λ„μ–΄κ°€κ² λ¨

```text
[0.783s][info   ][gc          ] GC(3) Pause Full (G1 Compaction Pause) 125M->125M(128M)
```
- **GC νƒ€μ…**: Full GC λ°μƒ, μ••μ¶•(compaction) μν–‰
- **ν¨κ³Ό**: λ©”λ¨λ¦¬λ” μ¤„μ§€ μ•μ•μΌλ‚ ννΈν™” ν•΄μ† μ‹λ„λ¨(**λ‹¨νΈν™” ν•΄μ†**μ™€ **λΉ κ³µκ°„ ν™•λ³΄**κ°€ λ©μ μ΄μ§€λ§, λ§μ€ κ°μ²΄κ°€ μ‚΄μ•„μμ–΄μ„ ν¨κ³Όλ” μ μ)
- **μ‹¤λ¬΄ ν¬μΈνΈ**: Full GCκ°€ μμ£Ό μΌμ–΄λ‚λ©΄ GC νλ‹/heap μ¦μ„¤ κ³ λ ¤ ν•„μ”

```text
[0.802s][info   ][gc          ] GC(11) Pause Full (G1 Compaction Pause) 127M->1M(128M)
```
- **κ²°κ³Ό**: GC(11)μ—μ„ λ€λ¶€λ¶„μ κ°μ²΄κ°€ μ •λ¦¬λμ–΄ heap μ‚¬μ©λ‰ κΈ‰κ°
- **μλ―Έ**: Humongous κ°μ²΄κ°€ λ¨λ‘ unreachable λμ–΄ μ κ±°
- **μ‹¤λ¬΄ ν¬μΈνΈ**: κΈ‰κ²©ν• GC ν¨μ¨ μƒμΉμ€ λ¶ν•„μ”ν• κ°μ²΄ λ€λ‰ μ κ±°κ°€ μ„±κ³µν–μμ„ μλ―Έ

```text
Exception in thread "main" java.lang.OutOfMemoryError: Java heap space
```
- **μλ―Έ**: - κ°μ²΄λ¥Ό λ„λ¬΄ λ§μ΄ λ§λ“¤μ–΄μ„ GCκ°€ λ”°λΌκ°€μ§€ λ»ν•¨ β†’ JVMμ΄ κ°•μ  μΆ…λ£λ¨
- **μ‹¤λ¬΄ ν¬μΈνΈ**: Humongous κ°μ²΄κ°€ λ§κ±°λ‚ Survivor/Oldμ— μ••λ ¥ λ†’μ„ κ²½μ° μμ£Ό λ°μƒν•¨

## 4. λ΅κ·Έ κΈ°λ° μ£Όμ” λ¶„μ„ ν¬μΈνΈ
| **GC ID** | **μΆ…λ¥**           | **μ£Όμ” μ΄λ²¤νΈ**                        |
| --------- | ---------------- | --------------------------------- |
| GC(0)     | Young GC         | Humongous κ°μ²΄ β†’ Eden β†’ Survivor μ΄λ™ |
| GC(1)     | Concurrent Start | λ£¨νΈ λ§ν‚Ή λ° Preclean μ‹μ‘               |
| GC(2)     | Young GC         | Evacuation μ‹¤ν¨, κ³µκ°„ λ¶€μ΅±              |
| GC(3)     | Full GC          | Compaction μν–‰ (ν¨κ³Ό λ―Έλ―Έ)             |
| GC(4~10)  | Full GC λ°λ³µ       | λ©”λ¨λ¦¬ λ¶€μ΅± μ§€μ†. Humongous κ°μ²΄ μ—¬μ „ν μ‚΄μ•„μμ  |
| GC(11)    | Full GC          | λ€λ¶€λ¶„ κ°μ²΄ νμ μ„±κ³µ β†’ Heap μ‚¬μ©λ‰ κΈ‰κ°        |
| μΆ…λ£        | OOM λ°μƒ           | λ©”λ¨λ¦¬ ν•κ³„ λ„λ‹¬ β†’ ν”„λ΅κ·Έλ¨ κ°•μ  μΆ…λ£            |

## 5. μ‹¤ν— κ²°κ³Ό μ”μ•½
- **Humongous Allocation**μ΄ λ°λ³µλλ©° ν™μ΄ λΉ λ¥΄κ² ν¬ν™”λ¨
- **Evacuation Failure**κ°€ λ°μƒν•μ—¬ G1GCκ°€ Full GCλ¥Ό μ λ„ν•¨
- **Full GC** (Compaction)μ„ μ—¬λ¬ μ°¨λ΅€ μν–‰ν–μΌλ‚ μΌλ¶€ κ°μ²΄κ°€ μ‚΄μ•„ μμ–΄ ν•΄μ λμ§€ μ•μ
- **GC**(11)μ—μ„ λ€λ¶€λ¶„μ Humongous κ°μ²΄κ°€ μ κ±°λμ–΄ λ©”λ¨λ¦¬ μ••λ°•μ΄ μΌμ‹μ μΌλ΅ ν•΄μ†λ¨
- κ·Έλ¬λ‚ μ΄ν›„ κ°μ²΄ μƒμ„±μ΄ κ³„μ†λλ©° **ν™ ν•κ³„λ¥Ό μ΄κ³Ό**, μµμΆ…μ μΌλ΅ OOM λ°μƒ

## 6. λ°°μ΄ μ  μ •λ¦¬
### 6-1. GC λ™μ‘ μ›λ¦¬ μ²΄κ°
- Region κΈ°λ° κµ¬μ΅°, Eden β†’ Survivor β†’ Old β†’ Humongous νλ¦„ ν™•μΈ
- Humongous κ°μ²΄κ°€ λ§μΌλ©΄ G1GCλ„ **κ°λ‹Ή λ¶κ°€**
- **Evacuation Failure**λ” μ„ν— μ‹ νΈ β†’ Full GC μ λ„

### 6-2. μ‹¤λ¬΄ μ μ© ν•™μµ
| **μƒν™©**     | **λ€μ‘ μ „λµ**                                                              |
| ---------- | ---------------------------------------------------------------------- |
| ν° κ°μ²΄ ν• λ‹Ή λ§μ | κ°μ²΄ ν¬κΈ° μ¤„μ΄κ±°λ‚ StreamμΌλ΅ μ²λ¦¬ (byte[], μ΄λ―Έμ§€ λ“±)                                 |
| Full GC μ¦μ | Heap μ©λ‰ μ¦κ°€ or GC νλ‹ (MaxGCPauseMillis, InitiatingHeapOccupancyPercent) |
| λ³‘λ© λ°μƒ      | GC λ΅κ·Έ + Heap Dump λ³‘ν–‰ λ¶„μ„μΌλ΅ μ›μΈ μ§„λ‹¨                                        |

## 7. νκ³ 
- G1GCλ” ν™μ„ RegionμΌλ΅ μΌκ°μ–΄ ν¨μ¨μ μΌλ΅ κ΄€λ¦¬ν•μ§€λ§, **ν° κ°μ²΄**(Humongous)κ°€ μ“μ΄λ©΄ λΉ λ¥΄κ² μ••λ°•μ΄ μ¨λ‹¤λ” μ μ„ μ‹¤κ°
- GC λ΅κ·Έ ν•΄μ„μ„ ν†µν•΄ μ–΄λ–¤ μ‹μ μ— μ–΄λ–¤ λ¬Έμ κ°€ μƒκΈ°λ”μ§€ **μ •λ‰μ μΌλ΅ ν™•μΈ κ°€λ¥**
- Full GCλ” μ‹μ¤ν… μ „μ²΄ μ„±λ¥μ— ν° μν–¥μ„ μ¤„ μ μμΌλ©°, GC λ΅κ·Έλ¥Ό **λ―Έλ¦¬ λ¶„μ„ν•κ³  λ€μ‘ν•λ” μµκ΄€μ΄ μ¤‘μ”ν•¨**
- GC λ΅κ·Έ, Heap Dump, VisualVM, GCViewer λ“±μ„ **μ‹¤λ¬΄μ—μ„ λ³‘ν–‰ ν™μ©ν•λ” λ¥λ ¥**μ΄ ν•µμ‹¬μ΄λ‹¤